<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whisper.cpp WASM Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 600px;
            margin: auto;
        }
        .input-section {
            margin-bottom: 20px;
        }
        .output-section {
            margin-top: 20px;
        }
        audio {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Whisper.cpp WASM Example</h1>
        <p>Minimal whisper.cpp example running fully in the browser.</p>

        <!-- Input Section -->
        <div class="input-section">
            <h3>Input:</h3>
            <label for="audio-file">Audio file:</label>
            <input type="file" id="audio-file" accept="audio/*">
            <br><br>
            <button id="start-mic">Start Microphone</button>
            <button id="stop-mic" disabled>Stop Microphone</button>
            <br><br>
            <progress id="progress-bar" value="0" max="100"></progress>
            <br>
            <audio id="audio-preview" controls></audio>
        </div>

        <!-- Model Information -->
        <div>
            <h3>Model:</h3>
            <p>tiny.en (Q5_1, 31 MB)</p>
        </div>

        <!-- Language Selection -->
        <div>
            <h3>Language:</h3>
            <select id="language-selector">
                <option value="en">English</option>
                <option value="ar">Arabic</option>
                <option value="zh">Chinese</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="ja">Japanese</option>
                <option value="ko">Korean</option>
                <option value="ru">Russian</option>
                <option value="hi">Hindi</option>
                <option value="it">Italian</option>
                <option value="pt">Portuguese</option>
                <option value="tr">Turkish</option>
                <option value="vi">Vietnamese</option>
            </select>
        </div>

        <!-- Threads -->
        <div>
            <h3>Threads:</h3>
            <input type="number" id="threads" value="8" min="1" max="16">
        </div>

        <!-- Action Buttons -->
        <div>
            <button id="transcribe-btn">Transcribe</button>
            <button id="translate-btn">Translate</button>
        </div>

        <!-- Output Section -->
        <div class="output-section">
            <h3>Output:</h3>
            <textarea id="output-text" rows="10" cols="50" readonly></textarea>
        </div>

        <!-- Footer -->
        <footer>
            <p>Build time: Sat May 20 20:00:06 2023</p>
            <p>Commit hash: 429b9785</p>
            <p>Commit subject: ggml : update WASM SIMD</p>
            <a href="https://github.com/ggerganov/whisper.cpp">Source Code</a>
        </footer>
    </div>
    <script type="text/javascript" src="https://whisper.ggerganov.com/helpers.js"></script>
    <script>
        // Default model
        const DEFAULT_MODEL = "tiny.en (Q5_1)";

        // Load the default model automatically
        console.log(`Loading default model: ${DEFAULT_MODEL}`);
        // Simulate loading the model here (replace with actual WASM model loading logic)
        function loadModel(modelName) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    console.log(`${modelName} loaded successfully.`);
                    resolve();
                }, 1000); // Simulate loading delay
            });
        }

        // Initialize the app
        async function initApp() {
            await loadModel(DEFAULT_MODEL);
            document.getElementById("transcribe-btn").disabled = false;
            document.getElementById("translate-btn").disabled = false;
        }

        // Transcribe button click handler
        document.getElementById("transcribe-btn").addEventListener("click", async () => {
            const progressBar = document.getElementById("progress-bar");
            const outputText = document.getElementById("output-text");

            outputText.value = "Transcribing...\n";
            progressBar.value = 0;

            // Simulate transcription process
            for (let i = 0; i <= 100; i += 10) {
                await new Promise((resolve) => setTimeout(resolve, 200)); // Simulate progress
                progressBar.value = i;
            }

            outputText.value += "Transcription complete:\n\nSample output text.";
        });

        // Translate button click handler
        document.getElementById("translate-btn").addEventListener("click", async () => {
            const progressBar = document.getElementById("progress-bar");
            const outputText = document.getElementById("output-text");

            outputText.value = "Translating...\n";
            progressBar.value = 0;

            // Simulate translation process
            for (let i = 0; i <= 100; i += 10) {
                await new Promise((resolve) => setTimeout(resolve, 200)); // Simulate progress
                progressBar.value = i;
            }

            outputText.value += "Translation complete:\n\nSample translated text.";
        });

        // Microphone handlers
        let mediaRecorder;
        document.getElementById("start-mic").addEventListener("click", async () => {
            const audioPreview = document.getElementById("audio-preview");
            const stopMicBtn = document.getElementById("stop-mic");

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);

                const chunks = [];
                mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const blob = new Blob(chunks, { type: "audio/wav" });
                    audioPreview.src = URL.createObjectURL(blob);
                };

                mediaRecorder.start();
                document.getElementById("start-mic").disabled = true;
                stopMicBtn.disabled = false;
            } catch (err) {
                console.error("Error accessing microphone:", err);
            }
        });

        document.getElementById("stop-mic").addEventListener("click", () => {
            if (mediaRecorder && mediaRecorder.state !== "inactive") {
                mediaRecorder.stop();
                document.getElementById("start-mic").disabled = false;
                document.getElementById("stop-mic").disabled = true;
            }
        });

        // Initialize the app on page load
        window.onload = initApp;
    </script>
    <script type="text/javascript" src="https://whisper.ggerganov.com/main.js"></script>
</body>
</html>
